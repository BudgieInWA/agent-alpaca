<template name="gameScreen">
    {{#if Template.subscriptionsReady}}
        {{#with doc}}
            <header>
                <h1>{{name}}</h1>
            </header>

            <h2>Players</h2>

            <h3>Red Team</h3>
            <ul>
                {{#each userId in players.red}}
                    <li class="{{if_Then_ (isSpymaster userId) "spymaster"}}">
                        {{> userReference id=userId}}
                    </li>
                {{/each}}
            </ul>

            <h3>Blue Team</h3>
            <ul>
                {{#each userId in players.blue}}
                    <li class="{{if_Then_ (isSpymaster userId) "spymaster"}}">
                        {{> userReference id=userId}}
                    </li>
                {{/each}}
            </ul>


            {{#if round}}
                <h2>
                    Round {{round.number}}
                    {{#if round.isEnded}}
                        (ended)
                    {{/if}}
                </h2>
                <section class="cards">
                    {{#each card in round.cards}}
                        <div class="card" data-index="{{@index}}">
                            {{card.word}}
                            {{card.colour}}
                            <div class="covering">{{card.coveringColour}}</div>
                        </div>
                    {{/each}}
                </section>

                <h3>Turn {{round.turn.number}} ({{round.turn.team}})</h3>
                {{#if round.turn}}
                    {{#if round.turn.clue}}
                        Clue: {{round.turn.clue.word}} {{round.turn.clue.number}}
                        Remaining Guesses: {{round.turn.guessesRemaining}}
                    {{else}}
                        {{#if canGiveClue}}
                            <form class="form-clue">
                                <label for="game-{{id}}-round.turn.clue.word">Word</label>
                                <input name="word" type="text"
                                       id="game-{{id}}-round.turn.clue.word">
                                <label for="game-{{id}}-round.turn.clue.word">Number</label>
                                <input name="number" type="number"
                                       id="game-{{id}}-round.turn.clue.number">
                                <button type="submit">Give Clue</button>
                            </form>
                        {{else}}
                            Waiting for clue...
                        {{/if}}
                    {{/if}}
                {{/if}}

                {{#if canNextTurn}}
                    <button class="next-turn">Next Turn</button>
                {{/if}}

            {{/if}}

            {{#if canStartRound}}
                <button class="start-round">Start Next Round</button>
            {{/if}}

        {{else}}
            unknown game
        {{/with}}
    {{else}}
        {{> inlineSpinner}}
    {{/if}}
</template>

<!-- Context: game _id -->
<template name="gameReference">
    <a href="/game/{{id}}">
        {{#if Template.subscriptionsReady}}
            {{name}}
        {{else}}
            loading...
        {{/if}}
    </a>
</template>
