<template name="gameScreen">
    {{#if Template.subscriptionsReady}}
        {{#with doc}}
            <article class="game">
                <header>
                    <h1>{{name}}</h1>
                </header>

                <section class="players">
                    <h2>Players</h2>

                    <div class="red team">
                        <h3>Red Team</h3>
                        <ul>
                            {{#each userId in players.red}}
                                <li class="{{if_Then_ (isSpymaster userId) "spymaster"}}">
                                    {{> userReference id=userId}}
                                </li>
                            {{/each}}
                        </ul>
                    </div>

                    <div class="blue team">
                        <h3>Blue Team</h3>
                        <ul>
                            {{#each userId in players.blue}}
                                <li class="{{if_Then_ (isSpymaster userId) "spymaster"}}">
                                    {{> userReference id=userId}}
                                </li>
                            {{/each}}
                        </ul>
                    </div>
                </section>

                {{#if round}}
                    <section class="round {{if_Then_ round.isEnded "ended"}}">
                        <h2>
                            Round {{round.number}}
                            {{#if round.isEnded}}
                                (ended)
                            {{/if}}
                        </h2>

                        {{#if round.turn}}
                            <section class="turn {{round.turn.team}}">
                                <span class="number">Turn #{{round.turn.number}}</span>
                                <h3>{{round.turn.team}} Team's Turn</h3>
                                {{#if round.turn.clue}}
                                    <div class="clue">
                                        <div class="word">
                                            <label for="game-{{id}}-round.turn.clue.word">Clue</label>
                                            <span id="game-{{id}}-round.turn.clue.word">
                                                {{round.turn.clue.word}}
                                            </span>
                                        </div>
                                        <div class="number">
                                            <label for="game-{{id}}-round.turn.clue.number">Number</label>
                                            <span id="game-{{id}}-round.turn.clue.number">
                                                {{round.turn.clue.number}}
                                            </span>
                                        </div>
                                        <div class="remaining">
                                            <label for="game-{{id}}-round.turn.remainingGuesses">
                                                Remaining Guesses
                                            </label>
                                            <span id="game-{{id}}-round.turn.remainingGuesses">
                                                {{round.turn.guessesRemaining}}
                                            </span>
                                            {{#if canNextTurn}}
                                                <button class="next-turn">End Turn</button>
                                            {{/if}}
                                        </div>
                                    </div>
                                {{else}}
                                    {{#if canGiveClue}}
                                        <form class="clue-form">
                                            <div class="word">
                                                <label for="game-{{id}}-round.turn.clue.word">Word</label>
                                                <input name="word" type="text"
                                                       id="game-{{id}}-round.turn.clue.word">
                                            </div>
                                            <div class="number">
                                                <label for="game-{{id}}-round.turn.clue.word">Number</label>
                                                <input name="number" type="number"
                                                       id="game-{{id}}-round.turn.clue.number">
                                            </div>
                                            <div class="buttons">
                                                <button type="submit">Give Clue</button>
                                            </div>
                                        </form>
                                    {{else}}
                                        <div class="no-clue">
                                            Waiting for a clue...
                                        </div>
                                    {{/if}}
                                {{/if}}
                            </section>
                        {{else}}
                            <section class="no-turn">
                                {{#if canNextTurn}}
                                    <button class="next-turn">Start First Turn</button>
                                {{/if}}
                            </section>
                        {{/if}}

                        <section class="cards">
                            {{#each card in round.cards}}
                                <div class="card" data-index="{{@index}}">
                                    {{card.word}}
                                    {{card.colour}}
                                    <div class="covering">{{card.coveringColour}}</div>
                                </div>
                            {{/each}}
                        </section>

                        {{#if canStartRound}}
                            <button class="start-round">Start Next Round</button>
                        {{/if}}
                    </section>
                {{else}}
                    <section class="no-round">
                        {{#if canStartRound}}
                            <button class="start-round">Start Playing</button>
                        {{/if}}
                    </section>
                {{/if}}
            </article>
        {{else}}
            unknown game
        {{/with}}
    {{else}}
        {{> inlineSpinner}}
    {{/if}}
</template>

<!-- Context: game _id -->
<template name="gameReference">
    <a href="/game/{{id}}">
        {{#if Template.subscriptionsReady}}
            {{name}}
        {{else}}
            loading...
        {{/if}}
    </a>
</template>
